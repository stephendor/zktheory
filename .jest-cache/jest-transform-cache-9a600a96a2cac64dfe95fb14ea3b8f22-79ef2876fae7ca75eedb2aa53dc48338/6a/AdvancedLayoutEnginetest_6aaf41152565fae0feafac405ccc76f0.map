{"version":3,"sources":["/home/stephen-dorman/dev/zktheory/src/__tests__/lib/AdvancedLayoutEngine.test.ts"],"sourcesContent":["/**\n * Comprehensive Unit Tests for AdvancedLayoutEngine\n * Tests layout strategy generation, mathematical accuracy, and performance\n */\n\nimport {\n  AdvancedLayoutEngine,\n  type AdvancedLayout,\n  type LayoutStrategy,\n  type LayoutDirection,\n  type LayoutNestingLevel\n} from '@/lib/AdvancedLayoutEngine';\n\nimport { Group, GroupElement, GroupTheoryLibrary } from '@/lib/GroupTheory';\nimport { StandardLayoutGenerator } from '@/lib/StandardLayouts';\n\nimport {\n  GroupTheoryValidator,\n  PrecisionValidator,\n  PerformanceValidator,\n  mathematicalMatchers,\n  MATHEMATICAL_PRECISION,\n  aggregateValidationResults\n} from '../utils/mathematicalValidation';\n\n// Extend Jest matchers\nexpect.extend(mathematicalMatchers);\n\ndescribe('AdvancedLayoutEngine', () => {\n  \n  // Test data setup\n  let cyclicGroup3: Group;\n  let cyclicGroup4: Group;\n  let dihedralGroup3: Group;\n  let symmetricGroup3: Group;\n  let trivialGroup: Group;\n\n  beforeAll(() => {\n    // Create test groups using GroupTheoryLibrary\n    cyclicGroup3 = GroupTheoryLibrary.getCyclicGroup(3);\n    cyclicGroup4 = GroupTheoryLibrary.getCyclicGroup(4);\n    dihedralGroup3 = GroupTheoryLibrary.getDihedralGroup(3);\n    symmetricGroup3 = GroupTheoryLibrary.getSymmetricGroup(3);\n    \n    // Create trivial group manually\n    trivialGroup = {\n      name: 'C1',\n      order: 1,\n      elements: [{ id: 'e', label: 'e', order: 1, inverse: 'e', conjugacyClass: 0 }],\n      operations: new Map([['e', new Map([['e', 'e']])]]),\n      generators: [],\n      isAbelian: true\n    };\n  });\n\n  describe('Layout Strategy Generation', () => {\n    \n    describe('generateOptimalLayout', () => {\n      test('generates layout for trivial group', () => {\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(trivialGroup, []);\n        \n        expect(layout).toBeDefined();\n        expect(layout.positions).toHaveProperty('e');\n        expect(layout.nestingStructure).toHaveLength(1);\n        expect(layout.description).toContain('Trivial group');\n        expect(layout.is3D).toBe(false);\n        \n        const position = layout.positions['e'];\n        expect(position.x).toBe(300);\n        expect(position.y).toBe(200);\n        expect(position.z).toBeUndefined();\n      });\n\n      test('generates layout for cyclic group C3', () => {\n        const generators = ['a'];\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, generators);\n        \n        expect(layout).toBeDefined();\n        expect(layout.positions).toBeDefined();\n        expect(layout.nestingStructure).toHaveLength(1);\n        expect(layout.is3D).toBe(false);\n        \n        // Verify all elements have positions\n        cyclicGroup3.elements.forEach(element => {\n          expect(layout.positions).toHaveProperty(element.id);\n          const pos = layout.positions[element.id];\n          expect(typeof pos.x).toBe('number');\n          expect(typeof pos.y).toBe('number');\n          expect(Number.isFinite(pos.x)).toBe(true);\n          expect(Number.isFinite(pos.y)).toBe(true);\n        });\n      });\n\n      test('generates layout for cyclic group C4', () => {\n        const generators = ['a'];\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, generators);\n        \n        expect(layout).toBeDefined();\n        expect(layout.nestingStructure).toHaveLength(1);\n        \n        // Verify circular layout for cyclic group with order > 2\n        const nestingLevel = layout.nestingStructure[0];\n        expect(nestingLevel.strategy).toBe('circular');\n        expect(nestingLevel.direction).toBe('XY');\n      });\n\n      test('generates layout for dihedral group D3', () => {\n        const generators = ['r', 's']; // rotation and reflection\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(dihedralGroup3, generators);\n        \n        expect(layout).toBeDefined();\n        expect(layout.nestingStructure).toHaveLength(2);\n        \n        // Should detect dihedral structure\n        const hasCircularStrategy = layout.nestingStructure.some(level => level.strategy === 'circular');\n        expect(hasCircularStrategy).toBe(true);\n      });\n\n      test('generates 3D layout when requested', () => {\n        const generators = ['a'];\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, generators, true);\n        \n        expect(layout.is3D).toBe(true);\n        \n        // All positions should have z coordinate\n        cyclicGroup3.elements.forEach(element => {\n          const pos = layout.positions[element.id];\n          expect(pos.z).toBeDefined();\n          expect(typeof pos.z).toBe('number');\n          expect(Number.isFinite(pos.z!)).toBe(true);\n        });\n      });\n\n      test('uses standard layout when available and not prefer3D', () => {\n        // Mock StandardLayoutGenerator to return a layout\n        const mockStandardLayout = {\n          positions: {\n            'e': { x: 0.5, y: 0.5 },\n            'a': { x: 0.3, y: 0.7 },\n            'a2': { x: 0.7, y: 0.3 }\n          },\n          description: 'Standard C3 layout'\n        };\n        \n        jest.spyOn(StandardLayoutGenerator, 'getStandardLayout').mockReturnValue(mockStandardLayout);\n        \n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a'], false);\n        \n        expect(layout.description).toBe('Standard C3 layout');\n        expect(layout.positions['e'].x).toBe(300); // Converted to canvas coordinates\n        expect(layout.positions['e'].y).toBe(200);\n        \n        StandardLayoutGenerator.getStandardLayout.mockRestore();\n      });\n    });\n\n    describe('strategy selection logic', () => {\n      test('selects linear strategy for order-2 generators', () => {\n        // Create a group with order-2 elements\n        const testGroup: Group = {\n          name: 'Test',\n          order: 4,\n          elements: [\n            { id: 'e', label: 'e', order: 1, inverse: 'e', conjugacyClass: 0 },\n            { id: 'a', label: 'a', order: 2, inverse: 'a', conjugacyClass: 1 },\n            { id: 'b', label: 'b', order: 2, inverse: 'b', conjugacyClass: 1 },\n            { id: 'ab', label: 'ab', order: 2, inverse: 'ab', conjugacyClass: 1 }\n          ],\n          operations: new Map(),\n          generators: ['a', 'b'],\n          isAbelian: true\n        };\n        \n        const layout = AdvancedLayoutEngine.generateOptimalLayout(testGroup, ['a', 'b']);\n        \n        // Should use linear strategies for order-2 generators\n        expect(layout.nestingStructure[0].strategy).toBe('linear');\n        expect(layout.nestingStructure[1].strategy).toBe('linear');\n        \n        // Should use different directions\n        expect(layout.nestingStructure[0].direction).toBe('X');\n        expect(layout.nestingStructure[1].direction).toBe('Y');\n      });\n\n      test('selects circular strategy for higher order cyclic groups', () => {\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n        \n        expect(layout.nestingStructure[0].strategy).toBe('circular');\n        expect(layout.nestingStructure[0].direction).toBe('XY');\n      });\n    });\n  });\n\n  describe('Nesting Structure Computation', () => {\n    \n    test('computes correct nesting levels', () => {\n      const generators = ['r', 's'];\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(dihedralGroup3, generators);\n      \n      expect(layout.nestingStructure).toHaveLength(2);\n      \n      layout.nestingStructure.forEach((level, index) => {\n        expect(level.nestingLevel).toBe(index);\n        expect(level.generator).toBe(generators[index]);\n        expect(level.subgroupElements).toBeDefined();\n        expect(Array.isArray(level.subgroupElements)).toBe(true);\n        expect(level.subgroupElements!.includes('e')).toBe(true);\n      });\n    });\n\n    test('generates valid subgroup elements for each level', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n      \n      const subgroupElements = layout.nestingStructure[0].subgroupElements!;\n      expect(subgroupElements).toContain('e');\n      expect(subgroupElements).toContain('a');\n      expect(subgroupElements.length).toBeGreaterThan(1);\n      \n      // All subgroup elements should be valid group elements\n      subgroupElements.forEach(elementId => {\n        const element = cyclicGroup4.elements.find(e => e.id === elementId);\n        expect(element).toBeDefined();\n      });\n    });\n\n    test('maintains mathematical consistency in nesting', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(symmetricGroup3, ['a', 'b']);\n      \n      // Verify nesting levels are sequential\n      layout.nestingStructure.forEach((level, index) => {\n        expect(level.nestingLevel).toBe(index);\n      });\n      \n      // Verify each level has valid strategy and direction\n      layout.nestingStructure.forEach(level => {\n        expect(['linear', 'circular', 'rotated']).toContain(level.strategy);\n        expect(['X', 'Y', 'Z', 'XY', 'XZ', 'YZ']).toContain(level.direction);\n      });\n    });\n  });\n\n  describe('3D Layout Positioning', () => {\n    \n    test('generates valid 3D coordinates', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a'], true);\n      \n      expect(layout.is3D).toBe(true);\n      \n      cyclicGroup4.elements.forEach(element => {\n        const pos = layout.positions[element.id];\n        expect(pos.z).toBeDefined();\n        expect(typeof pos.z).toBe('number');\n        expect(Number.isFinite(pos.z!)).toBe(true);\n      });\n    });\n\n    test('applies Z-direction linear layout correctly', () => {\n      // Create test scenario that would use Z direction\n      const testGroup: Group = {\n        name: 'TestZ',\n        order: 4,\n        elements: [\n          { id: 'e', label: 'e', order: 1, inverse: 'e', conjugacyClass: 0 },\n          { id: 'a', label: 'a', order: 2, inverse: 'a', conjugacyClass: 1 },\n          { id: 'b', label: 'b', order: 2, inverse: 'b', conjugacyClass: 1 },\n          { id: 'c', label: 'c', order: 2, inverse: 'c', conjugacyClass: 1 }\n        ],\n        operations: new Map(),\n        generators: ['a', 'b', 'c'],\n        isAbelian: true\n      };\n      \n      const layout = AdvancedLayoutEngine.generateOptimalLayout(testGroup, ['a', 'b', 'c'], true);\n      \n      // Third generator should use Z direction\n      expect(layout.nestingStructure[2].direction).toBe('Z');\n      \n      // Verify Z-coordinates vary for elements positioned by third generator\n      const zCoords = testGroup.elements.map(e => layout.positions[e.id].z!);\n      const uniqueZCoords = [...new Set(zCoords)];\n      expect(uniqueZCoords.length).toBeGreaterThan(1);\n    });\n\n    test('applies XZ and YZ circular layouts correctly', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(dihedralGroup3, ['r', 's'], true);\n      \n      // Should have some 3D positioning\n      const hasNonZeroZ = dihedralGroup3.elements.some(e => \n        layout.positions[e.id].z !== undefined && layout.positions[e.id].z !== 0\n      );\n      expect(hasNonZeroZ).toBe(true);\n    });\n  });\n\n  describe('Layout Strategy Application', () => {\n    \n    describe('Linear Layout', () => {\n      test('distributes elements along X-axis correctly', () => {\n        const testGroup: Group = {\n          name: 'LinearTest',\n          order: 3,\n          elements: [\n            { id: 'e', label: 'e', order: 1, inverse: 'e', conjugacyClass: 0 },\n            { id: 'a', label: 'a', order: 2, inverse: 'a', conjugacyClass: 1 },\n            { id: 'b', label: 'b', order: 2, inverse: 'b', conjugacyClass: 1 }\n          ],\n          operations: new Map(),\n          generators: ['a'],\n          isAbelian: true\n        };\n        \n        const layout = AdvancedLayoutEngine.generateOptimalLayout(testGroup, ['a']);\n        \n        // Elements should be aligned along X-axis with constant Y\n        const positions = Object.values(layout.positions);\n        const yCoords = positions.map(p => p.y);\n        const uniqueYCoords = [...new Set(yCoords)];\n        \n        // Should have consistent Y coordinate (allowing for floating point precision)\n        expect(uniqueYCoords.length).toBeLessThanOrEqual(2); // Identity might be at center\n        \n        // X coordinates should vary\n        const xCoords = positions.map(p => p.x);\n        const uniqueXCoords = [...new Set(xCoords)];\n        expect(uniqueXCoords.length).toBeGreaterThan(1);\n      });\n\n      test('maintains equal spacing in linear layout', () => {\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n        \n        // Get positions in order\n        const orderedPositions = cyclicGroup4.elements\n          .sort((a, b) => a.id.localeCompare(b.id))\n          .map(e => layout.positions[e.id]);\n        \n        // Calculate spacing between adjacent elements\n        const spacings: number[] = [];\n        for (let i = 1; i < orderedPositions.length; i++) {\n          const dx = orderedPositions[i].x - orderedPositions[i-1].x;\n          const dy = orderedPositions[i].y - orderedPositions[i-1].y;\n          const distance = Math.sqrt(dx*dx + dy*dy);\n          spacings.push(distance);\n        }\n        \n        // Verify spacings are approximately equal (within tolerance)\n        if (spacings.length > 1) {\n          const avgSpacing = spacings.reduce((a, b) => a + b, 0) / spacings.length;\n          spacings.forEach(spacing => {\n            global.testUtils.expectMathematicalAccuracy(spacing, avgSpacing, 1);\n          });\n        }\n      });\n    });\n\n    describe('Circular Layout', () => {\n      test('arranges elements in circular pattern', () => {\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n        \n        // Should use circular layout for C4\n        expect(layout.nestingStructure[0].strategy).toBe('circular');\n        \n        // Calculate distances from center for all elements\n        const centerX = 300; // Canvas center\n        const centerY = 200;\n        \n        const distances = cyclicGroup4.elements.map(element => {\n          const pos = layout.positions[element.id];\n          return Math.sqrt((pos.x - centerX)**2 + (pos.y - centerY)**2);\n        });\n        \n        // All elements (except possibly identity) should be approximately the same distance from center\n        const nonIdentityDistances = distances.filter(d => d > 10); // Filter out identity at center\n        if (nonIdentityDistances.length > 1) {\n          const avgDistance = nonIdentityDistances.reduce((a, b) => a + b, 0) / nonIdentityDistances.length;\n          nonIdentityDistances.forEach(distance => {\n            global.testUtils.expectMathematicalAccuracy(distance, avgDistance, 5);\n          });\n        }\n      });\n\n      test('maintains angular symmetry in circular layout', () => {\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n        \n        const centerX = 300;\n        const centerY = 200;\n        \n        // Calculate angles for all non-identity elements\n        const angles = cyclicGroup3.elements\n          .filter(e => e.id !== 'e')\n          .map(element => {\n            const pos = layout.positions[element.id];\n            return Math.atan2(pos.y - centerY, pos.x - centerX);\n          });\n        \n        if (angles.length > 1) {\n          // Calculate angular differences\n          const sortedAngles = angles.sort();\n          const angularDifferences: number[] = [];\n          \n          for (let i = 1; i < sortedAngles.length; i++) {\n            angularDifferences.push(sortedAngles[i] - sortedAngles[i-1]);\n          }\n          \n          // Add wrap-around difference\n          angularDifferences.push(2 * Math.PI - (sortedAngles[sortedAngles.length-1] - sortedAngles[0]));\n          \n          // All angular differences should be approximately equal\n          const expectedAngle = 2 * Math.PI / angles.length;\n          angularDifferences.forEach(angle => {\n            global.testUtils.expectMathematicalAccuracy(angle, expectedAngle, 0.1);\n          });\n        }\n      });\n    });\n\n    describe('Rotated Layout', () => {\n      test('applies rotation offset correctly', () => {\n        // Create scenario that uses rotated layout\n        const complexGroup: Group = {\n          name: 'Complex',\n          order: 8,\n          elements: Array.from({length: 8}, (_, i) => ({\n            id: `g${i}`,\n            label: `g${i}`,\n            order: i === 0 ? 1 : 8,\n            inverse: `g${i}`,\n            conjugacyClass: i\n          })),\n          operations: new Map(),\n          generators: ['g1'],\n          isAbelian: false\n        };\n        \n        const layout = AdvancedLayoutEngine.generateOptimalLayout(complexGroup, ['g1']);\n        \n        // Verify positions are generated\n        complexGroup.elements.forEach(element => {\n          const pos = layout.positions[element.id];\n          expect(Number.isFinite(pos.x)).toBe(true);\n          expect(Number.isFinite(pos.y)).toBe(true);\n        });\n      });\n    });\n  });\n\n  describe('Group Structure Analysis', () => {\n    \n    test('correctly identifies cyclic groups', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      \n      // Should detect cyclic structure and use appropriate strategy\n      expect(layout.nestingStructure).toHaveLength(1);\n      expect(layout.nestingStructure[0].strategy).toMatch(/circular|linear/);\n    });\n\n    test('correctly identifies dihedral groups', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(dihedralGroup3, ['r', 's']);\n      \n      // Should have two generators and appropriate strategies\n      expect(layout.nestingStructure).toHaveLength(2);\n      \n      // Should use strategies appropriate for dihedral structure\n      const strategies = layout.nestingStructure.map(level => level.strategy);\n      expect(strategies.some(s => s === 'circular')).toBe(true);\n    });\n\n    test('handles abelian groups correctly', () => {\n      expect(cyclicGroup3.isAbelian).toBe(true);\n      expect(cyclicGroup4.isAbelian).toBe(true);\n      expect(dihedralGroup3.isAbelian).toBe(false);\n      \n      const cyclicLayout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      const dihedralLayout = AdvancedLayoutEngine.generateOptimalLayout(dihedralGroup3, ['r', 's']);\n      \n      // Both should generate valid layouts\n      expect(cyclicLayout.positions).toBeDefined();\n      expect(dihedralLayout.positions).toBeDefined();\n    });\n  });\n\n  describe('Standard Layout Conversion', () => {\n    \n    test('converts standard layout to advanced layout format', () => {\n      const mockStandardLayout = {\n        positions: {\n          'e': { x: 0.5, y: 0.5 },\n          'a': { x: 0.3, y: 0.7 },\n          'a2': { x: 0.7, y: 0.3 }\n        },\n        description: 'Mock standard layout'\n      };\n      \n      jest.spyOn(StandardLayoutGenerator, 'getStandardLayout').mockReturnValue(mockStandardLayout);\n      \n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a'], false);\n      \n      expect(layout.positions['e'].x).toBe(300); // 0.5 * 600\n      expect(layout.positions['e'].y).toBe(200); // 0.5 * 400\n      expect(layout.positions['a'].x).toBe(180); // 0.3 * 600\n      expect(layout.positions['a'].y).toBe(280); // 0.7 * 400\n      expect(layout.description).toBe('Mock standard layout');\n      expect(layout.is3D).toBe(false);\n      expect(layout.nestingStructure).toHaveLength(0);\n      \n      StandardLayoutGenerator.getStandardLayout.mockRestore();\n    });\n  });\n\n  describe('Mathematical Accuracy', () => {\n    \n    test('maintains mathematical precision in coordinate calculations', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n      \n      // Verify all coordinates are finite and precise\n      cyclicGroup4.elements.forEach(element => {\n        const pos = layout.positions[element.id];\n        \n        expect(Number.isFinite(pos.x)).toBe(true);\n        expect(Number.isFinite(pos.y)).toBe(true);\n        expect(Number.isNaN(pos.x)).toBe(false);\n        expect(Number.isNaN(pos.y)).toBe(false);\n        \n        // Coordinates should be reasonable (within canvas bounds + some margin)\n        expect(pos.x).toBeGreaterThan(-100);\n        expect(pos.x).toBeLessThan(700);\n        expect(pos.y).toBeGreaterThan(-100);\n        expect(pos.y).toBeLessThan(500);\n      });\n    });\n\n    test('maintains group-theoretic consistency', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      \n      // All group elements should have positions\n      cyclicGroup3.elements.forEach(element => {\n        expect(layout.positions).toHaveProperty(element.id);\n      });\n      \n      // Number of positioned elements should match group order\n      const positionedElements = Object.keys(layout.positions);\n      expect(positionedElements).toHaveLength(cyclicGroup3.order);\n      \n      // Identity should be present\n      expect(layout.positions).toHaveProperty('e');\n    });\n\n    test('validates layout mathematical properties', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n      \n      // Test mathematical invariants\n      const positions = Object.values(layout.positions);\n      const xCoords = positions.map(p => p.x);\n      const yCoords = positions.map(p => p.y);\n      \n      // Validate numerical stability\n      const validation = PrecisionValidator.validateFloatingPointStability([...xCoords, ...yCoords]);\n      expect(validation.isValid).toBe(true);\n      \n      // Check for reasonable spread (elements shouldn't all be at same point)\n      const xRange = Math.max(...xCoords) - Math.min(...xCoords);\n      const yRange = Math.max(...yCoords) - Math.min(...yCoords);\n      expect(xRange + yRange).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Performance Testing', () => {\n    \n    test('layout generation completes within time bounds', () => {\n      const { result, duration } = global.testUtils.expectPerformance(() => {\n        return AdvancedLayoutEngine.generateOptimalLayout(symmetricGroup3, ['a', 'b']);\n      }, 500); // 500ms max\n      \n      expect(result).toBeDefined();\n      expect(result.positions).toBeDefined();\n      console.log(`Layout generation completed in ${duration.toFixed(2)}ms`);\n    });\n\n    test('memory usage is reasonable for layout generation', () => {\n      const { result, memoryIncrease } = global.testUtils.expectMemoryUsage(() => {\n        return AdvancedLayoutEngine.generateOptimalLayout(symmetricGroup3, ['a', 'b']);\n      }, 10); // 10MB max increase\n      \n      expect(result).toBeDefined();\n      console.log(`Memory increase: ${memoryIncrease.toFixed(2)}MB`);\n    });\n\n    test('scales appropriately with group size', () => {\n      const times: number[] = [];\n      const groups = [cyclicGroup3, cyclicGroup4, symmetricGroup3];\n      \n      groups.forEach(group => {\n        const startTime = performance.now();\n        AdvancedLayoutEngine.generateOptimalLayout(group, group.generators);\n        const endTime = performance.now();\n        times.push(endTime - startTime);\n      });\n      \n      // Performance should scale reasonably (not exponentially)\n      times.forEach(time => {\n        expect(time).toBeLessThan(1000); // 1 second max for test groups\n      });\n      \n      console.log('Scaling times:', times.map(t => `${t.toFixed(2)}ms`));\n    });\n\n    test('deterministic behavior for same inputs', () => {\n      const layout1 = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      const layout2 = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      \n      // Should produce identical results\n      expect(layout1.positions).toEqual(layout2.positions);\n      expect(layout1.nestingStructure).toEqual(layout2.nestingStructure);\n      expect(layout1.description).toBe(layout2.description);\n      expect(layout1.is3D).toBe(layout2.is3D);\n    });\n  });\n\n  describe('Edge Cases', () => {\n    \n    test('handles empty generators array', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, []);\n      \n      expect(layout).toBeDefined();\n      expect(layout.positions).toBeDefined();\n      // Should still position all elements somehow\n      expect(Object.keys(layout.positions)).toHaveLength(cyclicGroup3.order);\n    });\n\n    test('handles invalid generator names gracefully', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['invalid']);\n      \n      expect(layout).toBeDefined();\n      expect(layout.positions).toBeDefined();\n      // Should not crash, but may have default behavior\n    });\n\n    test('handles groups with single element', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(trivialGroup, []);\n      \n      expect(layout).toBeDefined();\n      expect(layout.positions).toHaveProperty('e');\n      expect(layout.nestingStructure).toHaveLength(1);\n      expect(layout.description).toContain('Trivial group');\n    });\n\n    test('handles large number of generators', () => {\n      const manyGenerators = Array.from({length: 10}, (_, i) => `g${i}`);\n      \n      // Should not crash even with many generators\n      expect(() => {\n        AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, manyGenerators);\n      }).not.toThrow();\n    });\n\n    test('handles extreme coordinate values gracefully', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a'], true);\n      \n      // Verify coordinates are not extreme\n      cyclicGroup4.elements.forEach(element => {\n        const pos = layout.positions[element.id];\n        expect(Math.abs(pos.x)).toBeLessThan(1e6);\n        expect(Math.abs(pos.y)).toBeLessThan(1e6);\n        if (pos.z !== undefined) {\n          expect(Math.abs(pos.z)).toBeLessThan(1e6);\n        }\n      });\n    });\n  });\n\n  describe('Integration with Group Theory', () => {\n    \n    test('respects group structure in layout', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      \n      // Verify all group elements are represented\n      const layoutElementIds = Object.keys(layout.positions);\n      const groupElementIds = cyclicGroup3.elements.map(e => e.id);\n      \n      expect(layoutElementIds.sort()).toEqual(groupElementIds.sort());\n    });\n\n    test('validates against group axioms', () => {\n      // Verify our test groups are mathematically valid\n      [cyclicGroup3, cyclicGroup4, dihedralGroup3, symmetricGroup3, trivialGroup].forEach(group => {\n        expect(group).toBeValidGroup();\n      });\n    });\n\n    test('maintains generator relationships in layout', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n      \n      // Generator should be included in nesting structure\n      expect(layout.nestingStructure[0].generator).toBe('a');\n      expect(layout.nestingStructure[0].subgroupElements).toContain('a');\n      expect(layout.nestingStructure[0].subgroupElements).toContain('e');\n    });\n  });\n\n  describe('Layout Quality Metrics', () => {\n    \n    test('minimizes edge crossings in planar layouts', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n      \n      // For cyclic groups, circular layout should minimize crossings\n      // Verify elements are positioned to form a reasonable graph\n      const positions = layout.positions;\n      const elementIds = Object.keys(positions);\n      \n      // Calculate minimum distance between any two elements\n      let minDistance = Infinity;\n      for (let i = 0; i < elementIds.length; i++) {\n        for (let j = i + 1; j < elementIds.length; j++) {\n          const pos1 = positions[elementIds[i]];\n          const pos2 = positions[elementIds[j]];\n          const distance = Math.sqrt((pos1.x - pos2.x)**2 + (pos1.y - pos2.y)**2);\n          minDistance = Math.min(minDistance, distance);\n        }\n      }\n      \n      // Elements shouldn't be too close (overlap) or too far apart\n      expect(minDistance).toBeGreaterThan(5);\n      expect(minDistance).toBeLessThan(200);\n    });\n\n    test('maintains visual balance in layout', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      \n      // Calculate center of mass of all positioned elements\n      const positions = Object.values(layout.positions);\n      const centerX = positions.reduce((sum, pos) => sum + pos.x, 0) / positions.length;\n      const centerY = positions.reduce((sum, pos) => sum + pos.y, 0) / positions.length;\n      \n      // Center of mass should be reasonably close to canvas center\n      const canvasCenterX = 300;\n      const canvasCenterY = 200;\n      \n      expect(Math.abs(centerX - canvasCenterX)).toBeLessThan(100);\n      expect(Math.abs(centerY - canvasCenterY)).toBeLessThan(100);\n    });\n\n    test('optimizes space utilization', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(symmetricGroup3, ['a', 'b']);\n      \n      // Calculate bounding box of all elements\n      const positions = Object.values(layout.positions);\n      const minX = Math.min(...positions.map(p => p.x));\n      const maxX = Math.max(...positions.map(p => p.x));\n      const minY = Math.min(...positions.map(p => p.y));\n      const maxY = Math.max(...positions.map(p => p.y));\n      \n      const width = maxX - minX;\n      const height = maxY - minY;\n      \n      // Layout should use reasonable portion of canvas space\n      expect(width).toBeGreaterThan(50); // Not too cramped\n      expect(height).toBeGreaterThan(50);\n      expect(width).toBeLessThan(600); // Not exceeding canvas\n      expect(height).toBeLessThan(400);\n    });\n  });\n});"],"names":["expect","extend","mathematicalMatchers","describe","cyclicGroup3","cyclicGroup4","dihedralGroup3","symmetricGroup3","trivialGroup","beforeAll","GroupTheoryLibrary","getCyclicGroup","getDihedralGroup","getSymmetricGroup","name","order","elements","id","label","inverse","conjugacyClass","operations","Map","generators","isAbelian","test","layout","AdvancedLayoutEngine","generateOptimalLayout","toBeDefined","positions","toHaveProperty","nestingStructure","toHaveLength","description","toContain","is3D","toBe","position","x","y","z","toBeUndefined","forEach","element","pos","Number","isFinite","nestingLevel","strategy","direction","hasCircularStrategy","some","level","mockStandardLayout","jest","spyOn","StandardLayoutGenerator","mockReturnValue","getStandardLayout","mockRestore","testGroup","index","generator","subgroupElements","Array","isArray","includes","length","toBeGreaterThan","elementId","find","e","zCoords","map","uniqueZCoords","Set","hasNonZeroZ","undefined","Object","values","yCoords","p","uniqueYCoords","toBeLessThanOrEqual","xCoords","uniqueXCoords","orderedPositions","sort","a","b","localeCompare","spacings","i","dx","dy","distance","Math","sqrt","push","avgSpacing","reduce","spacing","global","testUtils","expectMathematicalAccuracy","centerX","centerY","distances","nonIdentityDistances","filter","d","avgDistance","angles","atan2","sortedAngles","angularDifferences","PI","expectedAngle","angle","complexGroup","from","_","toMatch","strategies","s","cyclicLayout","dihedralLayout","isNaN","toBeLessThan","positionedElements","keys","validation","PrecisionValidator","validateFloatingPointStability","isValid","xRange","max","min","yRange","result","duration","expectPerformance","console","log","toFixed","memoryIncrease","expectMemoryUsage","times","groups","group","startTime","performance","now","endTime","time","t","layout1","layout2","toEqual","manyGenerators","not","toThrow","abs","layoutElementIds","groupElementIds","toBeValidGroup","elementIds","minDistance","Infinity","j","pos1","pos2","sum","canvasCenterX","canvasCenterY","minX","maxX","minY","maxY","width","height"],"mappings":"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"}