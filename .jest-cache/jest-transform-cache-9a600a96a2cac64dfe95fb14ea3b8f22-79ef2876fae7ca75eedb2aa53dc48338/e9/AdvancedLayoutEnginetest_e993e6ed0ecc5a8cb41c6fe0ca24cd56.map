{"version":3,"sources":["/home/stephen-dorman/dev/zktheory/src/__tests__/lib/AdvancedLayoutEngine.test.ts"],"sourcesContent":["/**\n * Comprehensive Unit Tests for AdvancedLayoutEngine\n * Tests layout strategy generation, mathematical accuracy, and performance\n */\n\nimport {\n  AdvancedLayoutEngine,\n  type AdvancedLayout,\n  type LayoutStrategy,\n  type LayoutDirection,\n  type LayoutNestingLevel\n} from '@/lib/AdvancedLayoutEngine';\n\nimport { Group, GroupElement, GroupTheoryLibrary } from '@/lib/GroupTheory';\nimport { GroupDatabase } from '@/lib/GroupDatabase';\nimport { StandardLayoutGenerator } from '@/lib/StandardLayouts';\n\nimport {\n  GroupTheoryValidator,\n  PrecisionValidator,\n  PerformanceValidator,\n  mathematicalMatchers,\n  MATHEMATICAL_PRECISION,\n  aggregateValidationResults\n} from '../utils/mathematicalValidation';\n\n// Extend Jest matchers\nexpect.extend(mathematicalMatchers);\n\ndescribe('AdvancedLayoutEngine', () => {\n  \n  // Test data setup\n  let cyclicGroup3: Group;\n  let cyclicGroup4: Group;\n  let dihedralGroup3: Group;\n  let symmetricGroup3: Group;\n  let trivialGroup: Group;\n\n  beforeAll(() => {\n    // Get test groups from GroupDatabase\n    cyclicGroup3 = GroupDatabase.getGroup('C3')!;\n    cyclicGroup4 = GroupDatabase.getGroup('C4')!;\n    dihedralGroup3 = GroupDatabase.getGroup('D3')!;\n    symmetricGroup3 = GroupDatabase.getGroup('S3')!;\n    \n    // Get trivial group from database\n    trivialGroup = GroupDatabase.getGroup('C1')!;\n  });\n\n  describe('Layout Strategy Generation', () => {\n    \n    describe('generateOptimalLayout', () => {\n      test('generates layout for trivial group', () => {\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(trivialGroup, []);\n        \n        expect(layout).toBeDefined();\n        expect(layout.positions).toHaveProperty('e');\n        expect(layout.is3D).toBe(false);\n        \n        const position = layout.positions['e'];\n        expect(typeof position.x).toBe('number');\n        expect(typeof position.y).toBe('number');\n        expect(position.z).toBeUndefined();\n      });\n\n      test('generates layout for cyclic group C3', () => {\n        // Use the actual generators from the group or fallback to common names\n        const generators = cyclicGroup3.generators.length > 0 ? cyclicGroup3.generators : ['a'];\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, generators);\n        \n        expect(layout).toBeDefined();\n        expect(layout.positions).toBeDefined();\n        expect(layout.is3D).toBe(false);\n        \n        // Verify all elements have positions\n        cyclicGroup3.elements.forEach(element => {\n          expect(layout.positions).toHaveProperty(element.id);\n          const pos = layout.positions[element.id];\n          expect(typeof pos.x).toBe('number');\n          expect(typeof pos.y).toBe('number');\n          expect(Number.isFinite(pos.x)).toBe(true);\n          expect(Number.isFinite(pos.y)).toBe(true);\n        });\n      });\n\n      test('generates layout for cyclic group C4', () => {\n        const generators = cyclicGroup4.generators.length > 0 ? cyclicGroup4.generators : ['a'];\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, generators);\n        \n        expect(layout).toBeDefined();\n        expect(layout.positions).toBeDefined();\n        \n        // Verify all elements have positions\n        cyclicGroup4.elements.forEach(element => {\n          expect(layout.positions).toHaveProperty(element.id);\n        });\n      });\n\n      test('generates layout for dihedral group D3', () => {\n        const generators = dihedralGroup3.generators.length > 0 ? dihedralGroup3.generators : ['r', 's'];\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(dihedralGroup3, generators);\n        \n        expect(layout).toBeDefined();\n        expect(layout.positions).toBeDefined();\n        \n        // Verify all elements have positions\n        dihedralGroup3.elements.forEach(element => {\n          expect(layout.positions).toHaveProperty(element.id);\n        });\n      });\n\n      test('generates 3D layout when requested', () => {\n        const generators = cyclicGroup3.generators.length > 0 ? cyclicGroup3.generators : ['a'];\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, generators, true);\n        \n        expect(layout.is3D).toBe(true);\n        \n        // All positions should have z coordinate when 3D is requested\n        cyclicGroup3.elements.forEach(element => {\n          const pos = layout.positions[element.id];\n          // Z coordinate might be 0 but should be defined for 3D layouts\n          expect(pos.z).toBeDefined();\n          expect(typeof pos.z).toBe('number');\n          expect(Number.isFinite(pos.z!)).toBe(true);\n        });\n      });\n\n      test('uses standard layout when available and not prefer3D', () => {\n        // Mock StandardLayoutGenerator to return a layout\n        const mockStandardLayout = {\n          positions: {\n            'e': { x: 0.5, y: 0.5 },\n            'a': { x: 0.3, y: 0.7 },\n            'a2': { x: 0.7, y: 0.3 }\n          },\n          description: 'Standard C3 layout'\n        };\n        \n        jest.spyOn(StandardLayoutGenerator, 'getStandardLayout').mockReturnValue(mockStandardLayout);\n        \n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a'], false);\n        \n        expect(layout.description).toBe('Standard C3 layout');\n        expect(layout.positions['e'].x).toBe(300); // Converted to canvas coordinates\n        expect(layout.positions['e'].y).toBe(200);\n        \n        StandardLayoutGenerator.getStandardLayout.mockRestore();\n      });\n    });\n\n    describe('strategy selection logic', () => {\n      test('selects linear strategy for order-2 generators', () => {\n        // Create a group with order-2 elements\n        const testGroup: Group = {\n          name: 'Test',\n          order: 4,\n          elements: [\n            { id: 'e', label: 'e', order: 1, inverse: 'e', conjugacyClass: 0 },\n            { id: 'a', label: 'a', order: 2, inverse: 'a', conjugacyClass: 1 },\n            { id: 'b', label: 'b', order: 2, inverse: 'b', conjugacyClass: 1 },\n            { id: 'ab', label: 'ab', order: 2, inverse: 'ab', conjugacyClass: 1 }\n          ],\n          operations: new Map(),\n          generators: ['a', 'b'],\n          isAbelian: true\n        };\n        \n        const layout = AdvancedLayoutEngine.generateOptimalLayout(testGroup, ['a', 'b']);\n        \n        // Should use linear strategies for order-2 generators\n        expect(layout.nestingStructure[0].strategy).toBe('linear');\n        expect(layout.nestingStructure[1].strategy).toBe('linear');\n        \n        // Should use different directions\n        expect(layout.nestingStructure[0].direction).toBe('X');\n        expect(layout.nestingStructure[1].direction).toBe('Y');\n      });\n\n      test('selects circular strategy for higher order cyclic groups', () => {\n        // Mock StandardLayoutGenerator to return null to force advanced layout generation\n        jest.spyOn(StandardLayoutGenerator, 'getStandardLayout').mockReturnValue(null);\n        \n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n        \n        expect(layout).toBeDefined();\n        expect(layout.nestingStructure.length).toBeGreaterThan(0);\n        \n        StandardLayoutGenerator.getStandardLayout.mockRestore();\n      });\n    });\n  });\n\n  describe('Nesting Structure Computation', () => {\n    \n    test('computes correct nesting levels', () => {\n      const generators = ['r', 's'];\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(dihedralGroup3, generators);\n      \n      expect(layout.nestingStructure).toHaveLength(2);\n      \n      layout.nestingStructure.forEach((level, index) => {\n        expect(level.nestingLevel).toBe(index);\n        expect(level.generator).toBe(generators[index]);\n        expect(level.subgroupElements).toBeDefined();\n        expect(Array.isArray(level.subgroupElements)).toBe(true);\n        expect(level.subgroupElements!.includes('e')).toBe(true);\n      });\n    });\n\n    test('generates valid subgroup elements for each level', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n      \n      const subgroupElements = layout.nestingStructure[0].subgroupElements!;\n      expect(subgroupElements).toContain('e');\n      expect(subgroupElements).toContain('a');\n      expect(subgroupElements.length).toBeGreaterThan(1);\n      \n      // All subgroup elements should be valid group elements\n      subgroupElements.forEach(elementId => {\n        const element = cyclicGroup4.elements.find(e => e.id === elementId);\n        expect(element).toBeDefined();\n      });\n    });\n\n    test('maintains mathematical consistency in nesting', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(symmetricGroup3, ['a', 'b']);\n      \n      // Verify nesting levels are sequential\n      layout.nestingStructure.forEach((level, index) => {\n        expect(level.nestingLevel).toBe(index);\n      });\n      \n      // Verify each level has valid strategy and direction\n      layout.nestingStructure.forEach(level => {\n        expect(['linear', 'circular', 'rotated']).toContain(level.strategy);\n        expect(['X', 'Y', 'Z', 'XY', 'XZ', 'YZ']).toContain(level.direction);\n      });\n    });\n  });\n\n  describe('3D Layout Positioning', () => {\n    \n    test('generates valid 3D coordinates', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a'], true);\n      \n      expect(layout.is3D).toBe(true);\n      \n      cyclicGroup4.elements.forEach(element => {\n        const pos = layout.positions[element.id];\n        expect(pos.z).toBeDefined();\n        expect(typeof pos.z).toBe('number');\n        expect(Number.isFinite(pos.z!)).toBe(true);\n      });\n    });\n\n    test('applies Z-direction linear layout correctly', () => {\n      // Create test scenario that would use Z direction\n      const testGroup: Group = {\n        name: 'TestZ',\n        order: 4,\n        elements: [\n          { id: 'e', label: 'e', order: 1, inverse: 'e', conjugacyClass: 0 },\n          { id: 'a', label: 'a', order: 2, inverse: 'a', conjugacyClass: 1 },\n          { id: 'b', label: 'b', order: 2, inverse: 'b', conjugacyClass: 1 },\n          { id: 'c', label: 'c', order: 2, inverse: 'c', conjugacyClass: 1 }\n        ],\n        operations: new Map(),\n        generators: ['a', 'b', 'c'],\n        isAbelian: true\n      };\n      \n      const layout = AdvancedLayoutEngine.generateOptimalLayout(testGroup, ['a', 'b', 'c'], true);\n      \n      // Third generator should use Z direction\n      expect(layout.nestingStructure[2].direction).toBe('Z');\n      \n      // Verify Z-coordinates vary for elements positioned by third generator\n      const zCoords = testGroup.elements.map(e => layout.positions[e.id].z!);\n      const uniqueZCoords = [...new Set(zCoords)];\n      expect(uniqueZCoords.length).toBeGreaterThan(1);\n    });\n\n    test('applies XZ and YZ circular layouts correctly', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(dihedralGroup3, ['r', 's'], true);\n      \n      // Should have some 3D positioning\n      const hasNonZeroZ = dihedralGroup3.elements.some(e => \n        layout.positions[e.id].z !== undefined && layout.positions[e.id].z !== 0\n      );\n      expect(hasNonZeroZ).toBe(true);\n    });\n  });\n\n  describe('Layout Strategy Application', () => {\n    \n    describe('Linear Layout', () => {\n      test('distributes elements along X-axis correctly', () => {\n        const testGroup: Group = {\n          name: 'LinearTest',\n          order: 3,\n          elements: [\n            { id: 'e', label: 'e', order: 1, inverse: 'e', conjugacyClass: 0 },\n            { id: 'a', label: 'a', order: 2, inverse: 'a', conjugacyClass: 1 },\n            { id: 'b', label: 'b', order: 2, inverse: 'b', conjugacyClass: 1 }\n          ],\n          operations: new Map(),\n          generators: ['a'],\n          isAbelian: true\n        };\n        \n        const layout = AdvancedLayoutEngine.generateOptimalLayout(testGroup, ['a']);\n        \n        // Elements should be aligned along X-axis with constant Y\n        const positions = Object.values(layout.positions);\n        const yCoords = positions.map(p => p.y);\n        const uniqueYCoords = [...new Set(yCoords)];\n        \n        // Should have consistent Y coordinate (allowing for floating point precision)\n        expect(uniqueYCoords.length).toBeLessThanOrEqual(2); // Identity might be at center\n        \n        // X coordinates should vary\n        const xCoords = positions.map(p => p.x);\n        const uniqueXCoords = [...new Set(xCoords)];\n        expect(uniqueXCoords.length).toBeGreaterThan(1);\n      });\n\n      test('maintains equal spacing in linear layout', () => {\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n        \n        // Get positions in order\n        const orderedPositions = cyclicGroup4.elements\n          .sort((a, b) => a.id.localeCompare(b.id))\n          .map(e => layout.positions[e.id]);\n        \n        // Calculate spacing between adjacent elements\n        const spacings: number[] = [];\n        for (let i = 1; i < orderedPositions.length; i++) {\n          const dx = orderedPositions[i].x - orderedPositions[i-1].x;\n          const dy = orderedPositions[i].y - orderedPositions[i-1].y;\n          const distance = Math.sqrt(dx*dx + dy*dy);\n          spacings.push(distance);\n        }\n        \n        // Verify spacings are approximately equal (within tolerance)\n        if (spacings.length > 1) {\n          const avgSpacing = spacings.reduce((a, b) => a + b, 0) / spacings.length;\n          spacings.forEach(spacing => {\n            global.testUtils.expectMathematicalAccuracy(spacing, avgSpacing, 1);\n          });\n        }\n      });\n    });\n\n    describe('Circular Layout', () => {\n      test('arranges elements in circular pattern', () => {\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n        \n        // Should use circular layout for C4\n        expect(layout.nestingStructure[0].strategy).toBe('circular');\n        \n        // Calculate distances from center for all elements\n        const centerX = 300; // Canvas center\n        const centerY = 200;\n        \n        const distances = cyclicGroup4.elements.map(element => {\n          const pos = layout.positions[element.id];\n          return Math.sqrt((pos.x - centerX)**2 + (pos.y - centerY)**2);\n        });\n        \n        // All elements (except possibly identity) should be approximately the same distance from center\n        const nonIdentityDistances = distances.filter(d => d > 10); // Filter out identity at center\n        if (nonIdentityDistances.length > 1) {\n          const avgDistance = nonIdentityDistances.reduce((a, b) => a + b, 0) / nonIdentityDistances.length;\n          nonIdentityDistances.forEach(distance => {\n            global.testUtils.expectMathematicalAccuracy(distance, avgDistance, 5);\n          });\n        }\n      });\n\n      test('maintains angular symmetry in circular layout', () => {\n        const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n        \n        const centerX = 300;\n        const centerY = 200;\n        \n        // Calculate angles for all non-identity elements\n        const angles = cyclicGroup3.elements\n          .filter(e => e.id !== 'e')\n          .map(element => {\n            const pos = layout.positions[element.id];\n            return Math.atan2(pos.y - centerY, pos.x - centerX);\n          });\n        \n        if (angles.length > 1) {\n          // Calculate angular differences\n          const sortedAngles = angles.sort();\n          const angularDifferences: number[] = [];\n          \n          for (let i = 1; i < sortedAngles.length; i++) {\n            angularDifferences.push(sortedAngles[i] - sortedAngles[i-1]);\n          }\n          \n          // Add wrap-around difference\n          angularDifferences.push(2 * Math.PI - (sortedAngles[sortedAngles.length-1] - sortedAngles[0]));\n          \n          // All angular differences should be approximately equal\n          const expectedAngle = 2 * Math.PI / angles.length;\n          angularDifferences.forEach(angle => {\n            global.testUtils.expectMathematicalAccuracy(angle, expectedAngle, 0.1);\n          });\n        }\n      });\n    });\n\n    describe('Rotated Layout', () => {\n      test('applies rotation offset correctly', () => {\n        // Create scenario that uses rotated layout\n        const complexGroup: Group = {\n          name: 'Complex',\n          order: 8,\n          elements: Array.from({length: 8}, (_, i) => ({\n            id: `g${i}`,\n            label: `g${i}`,\n            order: i === 0 ? 1 : 8,\n            inverse: `g${i}`,\n            conjugacyClass: i\n          })),\n          operations: new Map(),\n          generators: ['g1'],\n          isAbelian: false\n        };\n        \n        const layout = AdvancedLayoutEngine.generateOptimalLayout(complexGroup, ['g1']);\n        \n        // Verify positions are generated\n        complexGroup.elements.forEach(element => {\n          const pos = layout.positions[element.id];\n          expect(Number.isFinite(pos.x)).toBe(true);\n          expect(Number.isFinite(pos.y)).toBe(true);\n        });\n      });\n    });\n  });\n\n  describe('Group Structure Analysis', () => {\n    \n    test('correctly identifies cyclic groups', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      \n      // Should detect cyclic structure and use appropriate strategy\n      expect(layout.nestingStructure).toHaveLength(1);\n      expect(layout.nestingStructure[0].strategy).toMatch(/circular|linear/);\n    });\n\n    test('correctly identifies dihedral groups', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(dihedralGroup3, ['r', 's']);\n      \n      // Should have two generators and appropriate strategies\n      expect(layout.nestingStructure).toHaveLength(2);\n      \n      // Should use strategies appropriate for dihedral structure\n      const strategies = layout.nestingStructure.map(level => level.strategy);\n      expect(strategies.some(s => s === 'circular')).toBe(true);\n    });\n\n    test('handles abelian groups correctly', () => {\n      expect(cyclicGroup3.isAbelian).toBe(true);\n      expect(cyclicGroup4.isAbelian).toBe(true);\n      expect(dihedralGroup3.isAbelian).toBe(false);\n      \n      const cyclicLayout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      const dihedralLayout = AdvancedLayoutEngine.generateOptimalLayout(dihedralGroup3, ['r', 's']);\n      \n      // Both should generate valid layouts\n      expect(cyclicLayout.positions).toBeDefined();\n      expect(dihedralLayout.positions).toBeDefined();\n    });\n  });\n\n  describe('Standard Layout Conversion', () => {\n    \n    test('converts standard layout to advanced layout format', () => {\n      const mockStandardLayout = {\n        positions: {\n          'e': { x: 0.5, y: 0.5 },\n          'a': { x: 0.3, y: 0.7 },\n          'a2': { x: 0.7, y: 0.3 }\n        },\n        description: 'Mock standard layout'\n      };\n      \n      jest.spyOn(StandardLayoutGenerator, 'getStandardLayout').mockReturnValue(mockStandardLayout);\n      \n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a'], false);\n      \n      expect(layout.positions['e'].x).toBe(300); // 0.5 * 600\n      expect(layout.positions['e'].y).toBe(200); // 0.5 * 400\n      expect(layout.positions['a'].x).toBe(180); // 0.3 * 600\n      expect(layout.positions['a'].y).toBe(280); // 0.7 * 400\n      expect(layout.description).toBe('Mock standard layout');\n      expect(layout.is3D).toBe(false);\n      expect(layout.nestingStructure).toHaveLength(0);\n      \n      StandardLayoutGenerator.getStandardLayout.mockRestore();\n    });\n  });\n\n  describe('Mathematical Accuracy', () => {\n    \n    test('maintains mathematical precision in coordinate calculations', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n      \n      // Verify all coordinates are finite and precise\n      cyclicGroup4.elements.forEach(element => {\n        const pos = layout.positions[element.id];\n        \n        expect(Number.isFinite(pos.x)).toBe(true);\n        expect(Number.isFinite(pos.y)).toBe(true);\n        expect(Number.isNaN(pos.x)).toBe(false);\n        expect(Number.isNaN(pos.y)).toBe(false);\n        \n        // Coordinates should be reasonable (within canvas bounds + some margin)\n        expect(pos.x).toBeGreaterThan(-100);\n        expect(pos.x).toBeLessThan(700);\n        expect(pos.y).toBeGreaterThan(-100);\n        expect(pos.y).toBeLessThan(500);\n      });\n    });\n\n    test('maintains group-theoretic consistency', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      \n      // All group elements should have positions\n      cyclicGroup3.elements.forEach(element => {\n        expect(layout.positions).toHaveProperty(element.id);\n      });\n      \n      // Number of positioned elements should match group order\n      const positionedElements = Object.keys(layout.positions);\n      expect(positionedElements).toHaveLength(cyclicGroup3.order);\n      \n      // Identity should be present\n      expect(layout.positions).toHaveProperty('e');\n    });\n\n    test('validates layout mathematical properties', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n      \n      // Test mathematical invariants\n      const positions = Object.values(layout.positions);\n      const xCoords = positions.map(p => p.x);\n      const yCoords = positions.map(p => p.y);\n      \n      // Validate numerical stability\n      const validation = PrecisionValidator.validateFloatingPointStability([...xCoords, ...yCoords]);\n      expect(validation.isValid).toBe(true);\n      \n      // Check for reasonable spread (elements shouldn't all be at same point)\n      const xRange = Math.max(...xCoords) - Math.min(...xCoords);\n      const yRange = Math.max(...yCoords) - Math.min(...yCoords);\n      expect(xRange + yRange).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Performance Testing', () => {\n    \n    test('layout generation completes within time bounds', () => {\n      const { result, duration } = global.testUtils.expectPerformance(() => {\n        return AdvancedLayoutEngine.generateOptimalLayout(symmetricGroup3, ['a', 'b']);\n      }, 500); // 500ms max\n      \n      expect(result).toBeDefined();\n      expect(result.positions).toBeDefined();\n      console.log(`Layout generation completed in ${duration.toFixed(2)}ms`);\n    });\n\n    test('memory usage is reasonable for layout generation', () => {\n      const { result, memoryIncrease } = global.testUtils.expectMemoryUsage(() => {\n        return AdvancedLayoutEngine.generateOptimalLayout(symmetricGroup3, ['a', 'b']);\n      }, 10); // 10MB max increase\n      \n      expect(result).toBeDefined();\n      console.log(`Memory increase: ${memoryIncrease.toFixed(2)}MB`);\n    });\n\n    test('scales appropriately with group size', () => {\n      const times: number[] = [];\n      const groups = [cyclicGroup3, cyclicGroup4, symmetricGroup3];\n      \n      groups.forEach(group => {\n        const startTime = performance.now();\n        AdvancedLayoutEngine.generateOptimalLayout(group, group.generators);\n        const endTime = performance.now();\n        times.push(endTime - startTime);\n      });\n      \n      // Performance should scale reasonably (not exponentially)\n      times.forEach(time => {\n        expect(time).toBeLessThan(1000); // 1 second max for test groups\n      });\n      \n      console.log('Scaling times:', times.map(t => `${t.toFixed(2)}ms`));\n    });\n\n    test('deterministic behavior for same inputs', () => {\n      const layout1 = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      const layout2 = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      \n      // Should produce identical results\n      expect(layout1.positions).toEqual(layout2.positions);\n      expect(layout1.nestingStructure).toEqual(layout2.nestingStructure);\n      expect(layout1.description).toBe(layout2.description);\n      expect(layout1.is3D).toBe(layout2.is3D);\n    });\n  });\n\n  describe('Edge Cases', () => {\n    \n    test('handles empty generators array', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, []);\n      \n      expect(layout).toBeDefined();\n      expect(layout.positions).toBeDefined();\n      // Should still position all elements somehow\n      expect(Object.keys(layout.positions)).toHaveLength(cyclicGroup3.order);\n    });\n\n    test('handles invalid generator names gracefully', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['invalid']);\n      \n      expect(layout).toBeDefined();\n      expect(layout.positions).toBeDefined();\n      // Should not crash, but may have default behavior\n    });\n\n    test('handles groups with single element', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(trivialGroup, []);\n      \n      expect(layout).toBeDefined();\n      expect(layout.positions).toHaveProperty('e');\n      expect(layout.nestingStructure).toHaveLength(1);\n      expect(layout.description).toContain('Trivial group');\n    });\n\n    test('handles large number of generators', () => {\n      const manyGenerators = Array.from({length: 10}, (_, i) => `g${i}`);\n      \n      // Should not crash even with many generators\n      expect(() => {\n        AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, manyGenerators);\n      }).not.toThrow();\n    });\n\n    test('handles extreme coordinate values gracefully', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a'], true);\n      \n      // Verify coordinates are not extreme\n      cyclicGroup4.elements.forEach(element => {\n        const pos = layout.positions[element.id];\n        expect(Math.abs(pos.x)).toBeLessThan(1e6);\n        expect(Math.abs(pos.y)).toBeLessThan(1e6);\n        if (pos.z !== undefined) {\n          expect(Math.abs(pos.z)).toBeLessThan(1e6);\n        }\n      });\n    });\n  });\n\n  describe('Integration with Group Theory', () => {\n    \n    test('respects group structure in layout', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      \n      // Verify all group elements are represented\n      const layoutElementIds = Object.keys(layout.positions);\n      const groupElementIds = cyclicGroup3.elements.map(e => e.id);\n      \n      expect(layoutElementIds.sort()).toEqual(groupElementIds.sort());\n    });\n\n    test('validates against group axioms', () => {\n      // Verify our test groups are mathematically valid\n      [cyclicGroup3, cyclicGroup4, dihedralGroup3, symmetricGroup3, trivialGroup].forEach(group => {\n        expect(group).toBeValidGroup();\n      });\n    });\n\n    test('maintains generator relationships in layout', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n      \n      // Generator should be included in nesting structure\n      expect(layout.nestingStructure[0].generator).toBe('a');\n      expect(layout.nestingStructure[0].subgroupElements).toContain('a');\n      expect(layout.nestingStructure[0].subgroupElements).toContain('e');\n    });\n  });\n\n  describe('Layout Quality Metrics', () => {\n    \n    test('minimizes edge crossings in planar layouts', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup4, ['a']);\n      \n      // For cyclic groups, circular layout should minimize crossings\n      // Verify elements are positioned to form a reasonable graph\n      const positions = layout.positions;\n      const elementIds = Object.keys(positions);\n      \n      // Calculate minimum distance between any two elements\n      let minDistance = Infinity;\n      for (let i = 0; i < elementIds.length; i++) {\n        for (let j = i + 1; j < elementIds.length; j++) {\n          const pos1 = positions[elementIds[i]];\n          const pos2 = positions[elementIds[j]];\n          const distance = Math.sqrt((pos1.x - pos2.x)**2 + (pos1.y - pos2.y)**2);\n          minDistance = Math.min(minDistance, distance);\n        }\n      }\n      \n      // Elements shouldn't be too close (overlap) or too far apart\n      expect(minDistance).toBeGreaterThan(5);\n      expect(minDistance).toBeLessThan(200);\n    });\n\n    test('maintains visual balance in layout', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(cyclicGroup3, ['a']);\n      \n      // Calculate center of mass of all positioned elements\n      const positions = Object.values(layout.positions);\n      const centerX = positions.reduce((sum, pos) => sum + pos.x, 0) / positions.length;\n      const centerY = positions.reduce((sum, pos) => sum + pos.y, 0) / positions.length;\n      \n      // Center of mass should be reasonably close to canvas center\n      const canvasCenterX = 300;\n      const canvasCenterY = 200;\n      \n      expect(Math.abs(centerX - canvasCenterX)).toBeLessThan(100);\n      expect(Math.abs(centerY - canvasCenterY)).toBeLessThan(100);\n    });\n\n    test('optimizes space utilization', () => {\n      const layout = AdvancedLayoutEngine.generateOptimalLayout(symmetricGroup3, ['a', 'b']);\n      \n      // Calculate bounding box of all elements\n      const positions = Object.values(layout.positions);\n      const minX = Math.min(...positions.map(p => p.x));\n      const maxX = Math.max(...positions.map(p => p.x));\n      const minY = Math.min(...positions.map(p => p.y));\n      const maxY = Math.max(...positions.map(p => p.y));\n      \n      const width = maxX - minX;\n      const height = maxY - minY;\n      \n      // Layout should use reasonable portion of canvas space\n      expect(width).toBeGreaterThan(50); // Not too cramped\n      expect(height).toBeGreaterThan(50);\n      expect(width).toBeLessThan(600); // Not exceeding canvas\n      expect(height).toBeLessThan(400);\n    });\n  });\n});"],"names":["expect","extend","mathematicalMatchers","describe","cyclicGroup3","cyclicGroup4","dihedralGroup3","symmetricGroup3","trivialGroup","beforeAll","GroupDatabase","getGroup","test","layout","AdvancedLayoutEngine","generateOptimalLayout","toBeDefined","positions","toHaveProperty","is3D","toBe","position","x","y","z","toBeUndefined","generators","length","elements","forEach","element","id","pos","Number","isFinite","mockStandardLayout","description","jest","spyOn","StandardLayoutGenerator","mockReturnValue","getStandardLayout","mockRestore","testGroup","name","order","label","inverse","conjugacyClass","operations","Map","isAbelian","nestingStructure","strategy","direction","toBeGreaterThan","toHaveLength","level","index","nestingLevel","generator","subgroupElements","Array","isArray","includes","toContain","elementId","find","e","zCoords","map","uniqueZCoords","Set","hasNonZeroZ","some","undefined","Object","values","yCoords","p","uniqueYCoords","toBeLessThanOrEqual","xCoords","uniqueXCoords","orderedPositions","sort","a","b","localeCompare","spacings","i","dx","dy","distance","Math","sqrt","push","avgSpacing","reduce","spacing","global","testUtils","expectMathematicalAccuracy","centerX","centerY","distances","nonIdentityDistances","filter","d","avgDistance","angles","atan2","sortedAngles","angularDifferences","PI","expectedAngle","angle","complexGroup","from","_","toMatch","strategies","s","cyclicLayout","dihedralLayout","isNaN","toBeLessThan","positionedElements","keys","validation","PrecisionValidator","validateFloatingPointStability","isValid","xRange","max","min","yRange","result","duration","expectPerformance","console","log","toFixed","memoryIncrease","expectMemoryUsage","times","groups","group","startTime","performance","now","endTime","time","t","layout1","layout2","toEqual","manyGenerators","not","toThrow","abs","layoutElementIds","groupElementIds","toBeValidGroup","elementIds","minDistance","Infinity","j","pos1","pos2","sum","canvasCenterX","canvasCenterY","minX","maxX","minY","maxY","width","height"],"mappings":"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"}